# 安卓自定义瀑布图控件 #

## 引言 ##

之前写过电平图和频谱图的实现的文章，在这片文章中，我将要讲解频谱瀑布图的实现。

频谱瀑布图又叫谱阵图，它是将振动信号的功率谱或幅值谱随转速变化而叠置而成的三维谱图，显示振动信号中各谐波成分随转速变化的情况。普通频谱图x轴是频率，y轴是幅度；而瀑布图x轴是频率，y轴是时间，幅度则用不同颜色表示，随着时间的的变化，整个频谱由上到下移动，看起来像瀑布，所以叫瀑布图。

瀑布图也叫雨点图，对于查看猝发信号或者跳频信号的效果十分明显，可以很清晰的看到信号的变化，这里就不模拟和展示了。

首先看下效果图：

![](https://i.imgur.com/Gegtr2k.png)

![](https://i.imgur.com/PSxlOkC.png)

![](https://i.imgur.com/MBgzOEF.png)

![](https://i.imgur.com/JTFV3W0.png)

实现了，色带自定义，频谱信号缩放，手指按下显示当前点的频率等。

## 实现 ##

### 布局 ###

这个的布局相对比较简单，就是一个色带区和信号绘制区，如下图：

![](https://i.imgur.com/pY1c9C5.png)

左边是一个渐变的色带，其对应右边信号幅度的强弱。

### 编码 ###

自定义控件，前面的步骤都差不多，新建类，attrs.xml，初始化，onMeasure()，onDraw(),我们直接从onDraw()开始吧。

在我最初实现第一个版本的时候，性能问题非常严重，绘制的点数多了之后，界面卡顿非常严重，后来我在绘图的机制和绘图的效率方面做了优化之后，效果非常好，测试Y轴1000行，X轴801个点，非常流畅，毫无压力。

我的第一个优化点是，采用离屏Canvas机制：即采用异步方式绘制图形，完成之后再回调通知onDraw()方法进行屏幕绘制。

第二个优化点是，在对数据的处理时，不再保存所有的矩阵数据，不做横向和纵向的矩阵遍历。已绘制了的信号直接裁剪Bitmap，新到的信号才遍历绘制，然后贴在一起，就完成信号的绘制。这就完成性能质的飞跃啊。












最后，如果要集成使用控件，可能还需添加其他功能或方法，才能完善系统，可以定制开发，如果有需要可以联系本人。

最后1，我的联系方式，呃,,如果您真的需要的话，随便那种方式应该都可以在到我的，哈哈，提醒一下，在代码里面也有，例如：

	/**
	 * @Title: SpectrumView.java
	 * @Package: com.an.view
	 * @Description: 自定义频谱图控件
	 * @Author: AnuoF
	 * @QQ/WeChat: 188512936
	 * @Date 2019.08.09 20:27
	 * @Version V1.0
	 */
最后2：奉上源码，自由、开源：[https://github.com/AnuoF/android_customview](https://github.com/AnuoF/android_customview)

最后，定稿!!!!

AnuoF  
Chengdu  
Aug 20,2019